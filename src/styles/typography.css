@reference './global.css';

@layer components {
  .prose {
    @apply text-foreground text-base sm:text-lg leading-relaxed;
    @apply [&>*]:first:mt-0 [&>*]:last:mb-0 [&>section:first-child>*]:mt-0 [&>section:last-child>*]:mb-0;
    /* 暗夜模式下的基础优化 */
    @apply dark:text-foreground/95 dark:leading-relaxed;

    p {
      @apply text-foreground my-4 sm:my-6 leading-relaxed sm:leading-loose not-first:mt-4 sm:not-first:mt-6;
      /* 暗夜模式段落优化 */
      @apply dark:text-foreground/90 dark:leading-relaxed dark:tracking-wide;
    }

    h1 {
      @apply text-foreground mt-0 mb-6 sm:mb-8 scroll-m-20 text-2xl sm:text-4xl leading-tight font-bold;
      /* 暗夜模式标题优化 */
      @apply dark:text-foreground dark:font-bold dark:tracking-tight;
    }

    h2 {
      @apply text-foreground mt-8 sm:mt-10 mb-4 sm:mb-6 scroll-m-20 text-xl sm:text-3xl leading-snug font-semibold;
      /* 暗夜模式标题优化 */
      @apply dark:text-foreground dark:font-semibold dark:tracking-tight;
    }

    h3 {
      @apply text-foreground mt-6 sm:mt-8 mb-3 sm:mb-5 scroll-m-20 text-lg sm:text-2xl leading-snug font-medium;
      /* 暗夜模式标题优化 */
      @apply dark:text-foreground dark:font-semibold dark:tracking-tight;
    }

    h4 {
      @apply text-foreground mt-6 sm:mt-8 mb-3 sm:mb-4 scroll-m-20 text-base sm:text-xl leading-normal font-medium;
    }

    h5 {
      @apply text-foreground mt-4 sm:mt-6 mb-3 sm:mb-4 scroll-m-20 text-base sm:text-lg leading-normal font-medium;
    }

    h6 {
      @apply text-foreground mt-4 sm:mt-6 mb-3 sm:mb-4 scroll-m-20 text-sm sm:text-base leading-normal font-medium;
    }

    /* 内部链接样式 */
    a:not([href^="http"]) {
      @apply text-primary decoration-primary hover:decoration-primary/80 font-medium break-words underline underline-offset-4 transition-colors duration-200 ease-in-out;
      /* 暗夜模式链接优化 */
      @apply dark:text-primary dark:decoration-primary/80 dark:hover:text-primary/90 dark:hover:decoration-primary;
    }

    strong {
      @apply text-foreground font-semibold;
      /* 暗夜模式强调文字优化 */
      @apply dark:text-foreground dark:font-bold;
    }

    ul {
      @apply marker:text-primary/50 my-6 ml-8 list-disc [&>li]:mt-3;
    }

    ol {
      @apply marker:text-primary/50 my-6 ml-8 list-decimal [&>li]:mt-3;
      @apply [&[type='A']]:list-[upper-alpha] [&[type='I']]:list-[upper-roman] [&[type='a']]:list-[lower-alpha] [&[type='i']]:list-[lower-roman];
    }

    li {
      @apply text-foreground pl-3 leading-relaxed [&>p]:my-0;
      /* 暗夜模式列表项优化 */
      @apply dark:text-foreground/90 dark:leading-relaxed;
    }

    ul ul,
    ol ol,
    ul ol,
    ol ul {
      @apply marker:text-primary/30 my-3 ml-8;
    }

    code {
      @apply bg-muted text-foreground relative rounded-md px-2 py-1 font-mono text-sm font-medium break-words whitespace-pre-wrap;
      /* 暗夜模式代码优化 */
      @apply dark:bg-muted/80 dark:text-foreground dark:border dark:border-border/50;
    }

    pre {
      @apply bg-muted text-foreground max-w-full overflow-x-auto rounded-lg p-3 sm:p-4 font-mono text-xs sm:text-sm;
      /* 暗夜模式代码块优化 */
      @apply dark:bg-muted/60 dark:text-foreground dark:border dark:border-border/50 dark:shadow-lg;
    }

    /* 表格在移动端横向滚动与尺寸优化 */
    .table-wrapper { @apply w-full overflow-x-auto; }
    table { @apply min-w-[640px] sm:min-w-0; }

    /* 图片与视频在小屏幕的间距与阴影优化 */
    img,
    video {
      @apply my-6 sm:my-10 rounded-lg shadow-md;
    }

    .expressive-code {
      @apply my-8 [&_.title]:font-semibold!;
      
      /* 移动端优化 */
      @apply mx-0 rounded-lg overflow-hidden;
      
      /* 代码框架样式 */
      .frame {
        @apply rounded-lg border border-border/50;
      }
      
      /* 代码内容区域 */
      .code {
        @apply overflow-x-auto;
        /* 移动端滚动优化 */
        scrollbar-width: thin;
        scrollbar-color: hsl(var(--muted-foreground)) transparent;
        
        /* Webkit浏览器滚动条样式 */
        &::-webkit-scrollbar {
          height: 8px;
        }
        
        &::-webkit-scrollbar-track {
          @apply bg-transparent;
        }
        
        &::-webkit-scrollbar-thumb {
          @apply bg-muted-foreground/30 rounded-full;
        }
        
        &::-webkit-scrollbar-thumb:hover {
          @apply bg-muted-foreground/50;
        }
      }
      
      /* 复制按钮优化 */
      .copy {
        @apply transition-all duration-200;
        /* 移动端触摸优化 */
        min-height: 44px;
        min-width: 44px;
        
        /* 确保按钮在移动端可见 */
        @apply opacity-100 sm:opacity-0 sm:group-hover:opacity-100;
      }
      
      /* 标题栏优化 */
      .header {
        @apply px-4 py-2 text-sm font-medium;
        @apply border-b border-border/50;
      }
      
      /* 行号优化 */
      .line-numbers {
        @apply select-none text-muted-foreground/60;
        /* 移动端行号间距调整 */
        @apply text-xs sm:text-sm;
      }
      
      /* 代码行优化 */
      .line {
        @apply px-4 py-1;
        /* 移动端代码字体大小 */
        @apply text-xs sm:text-sm;
        
        /* 确保代码不会换行 */
        white-space: pre;
        word-break: keep-all;
      }
    }

    blockquote {
      @apply text-muted-foreground bg-muted/30 my-8 rounded-md border-l-4 border-l-primary pl-6 italic;
      @apply py-4 text-sm leading-relaxed;
      @apply [&>p]:my-0 [&>p:first-child]:mt-0 [&>p:last-child]:mb-0;
      /* 暗夜模式引用块优化 */
      @apply dark:text-foreground/80 dark:bg-muted/20 dark:border-l-primary/60 dark:shadow-sm;
    }

    hr {
      @apply border-border my-10 border-t-2;
    }

    table {
      @apply my-10 w-full border-collapse overflow-hidden rounded-lg text-sm shadow-sm text-foreground;
      /* 暗夜模式表格优化 */
      @apply dark:bg-muted/20 dark:border dark:border-border/50 dark:shadow-lg;
    }

    thead {
      @apply bg-muted/30 text-foreground font-semibold;
      /* 暗夜模式表头优化 */
      @apply dark:bg-muted/40 dark:text-foreground dark:font-semibold;
    }

    th {
      @apply border border-border text-foreground px-6 py-3 text-left font-medium [&[align=center]]:text-center [&[align=right]]:text-right;
      /* 暗夜模式表头单元格优化 */
      @apply dark:border-border/50 dark:text-foreground dark:font-semibold;
    }

    tbody tr {
      @apply border-border even:bg-muted/50 odd:bg-muted/30 border-b;
      /* 暗夜模式表格行优化 */
      @apply dark:border-border/30 dark:even:bg-muted/30 dark:odd:bg-muted/20;
    }

    td {
      @apply border border-border text-foreground px-6 py-3 text-left [&[align=center]]:text-center [&[align=right]]:text-right;
      /* 暗夜模式表格单元格优化 */
      @apply dark:border-border/30 dark:text-foreground/90;
    }

    img,
    video {
      @apply my-10 rounded-lg shadow-md;
    }

    figcaption {
      @apply text-muted-foreground mt-4 text-sm italic;
    }

    kbd {
      @apply text-foreground bg-muted border-border rounded-md border px-3 py-1 font-mono text-xs font-medium shadow-sm;
      @apply [&>span[data-line='']>*]:text-(--shiki-light) dark:[&>span[data-line='']>*]:text-(--shiki-dark);
    }

    .katex-display {
      @apply my-8 overflow-x-auto overflow-y-hidden py-3 tracking-normal;
      @apply [&>span[data-line='']>*]:text-(--shiki-light) dark:[&>span[data-line='']>*]:text-(--shiki-dark);
    }

    .katex {
      @apply text-foreground;
    }
    .katex * {
      @apply text-foreground;
    }
  }

  
  .font-inter {
    font-family: var(--font-sans);
  }

  /* 标题样式优化 - 使用Inter */
  .heading-modern {
    @apply font-sans font-semibold tracking-tight;
  }

  /* 代码样式优化 - 使用Lucida Console */
  .font-code {
    font-family: var(--font-mono);
    font-feature-settings: "liga" 0; /* 禁用连字，保持传统等宽效果 */
  }

  /* 移动端优化 */
  @media (max-width: 768px) {
    .prose {
      font-size: 0.983rem;
      line-height: 1.8;
      padding-left: 0; /* container handles padding */
      padding-right: 0; /* container handles padding */
      margin-left: 0;
      margin-right: 0;
    }
  
    .prose h1 { font-size: 1.75rem; margin: 0.7rem 0; }
    .prose h2 { font-size: 1.35rem; margin: 0.6rem 0; }
    .prose h3 { font-size: 1.2rem; margin: 0.55rem 0; }
    .prose p { margin: 0.5rem 0; }
    .prose ul, .prose ol { margin: 0.5rem 0 0.5rem 1.2rem; }
    .prose pre { margin: 0.6rem 0; }
    .prose img { margin: 0.75rem 0; border-radius: 0.75rem; }
  }
}
