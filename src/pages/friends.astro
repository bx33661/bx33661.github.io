---
import Link from '@/components/Link.astro'
import PageHead from '@/components/PageHead.astro'
import { buttonVariants } from '@/components/ui/button'
import Layout from '@/layouts/Layout.astro'
import { FRIEND_LINKS } from '@/consts'
import { Icon } from 'astro-icon/components'
import { ORGANIZATION_LINKS } from '@/consts'
import { ScrollReveal } from "@/components/react/scroll-animations"
import Breadcrumbs from '@/components/Breadcrumbs.astro'

const currentUrl = Astro.url;
const friendCount = FRIEND_LINKS.length
const orgCount = ORGANIZATION_LINKS.length
---

<Layout canonicalUrl={currentUrl}>
  <PageHead slot="head" title="友情链接 - BX/bpple" />
  <div class="flex flex-col gap-y-8 px-4 py-6 sm:gap-y-12 sm:px-8 sm:py-8 lg:px-16">
    <Breadcrumbs items={[{ label: '友链', icon: 'lucide:users' }]} />
    <!-- 页面标题 -->
    <ScrollReveal client:load direction="up" threshold={0.2}>
      <section class="text-center mobile-spacing">
        <div class="inline-flex items-center gap-2 rounded-full bg-primary/10 text-primary px-3 py-1 border border-primary/20 mb-3">
          <Icon name="lucide:sparkles" class="size-4" /> 精选友链与团队
        </div>
        <h1 class="font-custom text-foreground text-2xl font-extrabold sm:text-4xl lg:text-5xl">
          友情链接
        </h1>
        <p class="text-muted-foreground text-base mt-3 max-w-2xl mx-auto leading-relaxed sm:text-lg">
          收录常读/常用的站点，也欢迎更多优质博客互换友链。
        </p>
        <div class="mt-4 flex flex-wrap justify-center gap-3 text-sm">
          <span class="inline-flex items-center gap-2 rounded-full bg-primary/10 text-primary px-3 py-1 border border-primary/20 shadow-[0_8px_30px_-12px_rgba(79,70,229,0.35)]">
            <Icon name="lucide:link" class="size-4" /> 当前友链 {friendCount}
          </span>
          <span class="inline-flex items-center gap-2 rounded-full bg-muted text-muted-foreground px-3 py-1 border border-border/60">
            <Icon name="lucide:shield-check" class="size-4" /> 组织/团队 {orgCount}
          </span>
        </div>
      </section>
    </ScrollReveal>

    <!-- 友链申请说明 -->
    <ScrollReveal client:load direction="up" delay={0.05} threshold={0.2}>
      <section class="space-y-4 sm:space-y-6">
        <h2 class="font-custom text-foreground text-xl font-bold sm:text-3xl">申请友链</h2>
        <div class="bg-muted/50 rounded-lg p-4 space-y-3 sm:p-6 sm:space-y-4 mobile-card">
          <p class="text-foreground text-base sm:text-lg">
            欢迎与我交换友链！请确保您的网站符合以下要求：
          </p>
          <ul class="space-y-2 text-muted-foreground text-sm sm:text-base">
            <li class="flex items-start gap-2">
              <Icon name="lucide:check" class="size-4 text-green-500 mt-0.5 shrink-0" />
              <span>网站内容积极向上，无违法违规内容</span>
            </li>
            <li class="flex items-start gap-2">
              <Icon name="lucide:check" class="size-4 text-green-500 mt-0.5 shrink-0" />
              <span>网站能够正常访问，加载速度合理</span>
            </li>
            <li class="flex items-start gap-2">
              <Icon name="lucide:check" class="size-4 text-green-500 mt-0.5 shrink-0" />
              <span>优先考虑技术类、学习类博客</span>
            </li>
            <li class="flex items-start gap-2">
              <Icon name="lucide:check" class="size-4 text-green-500 mt-0.5 shrink-0" />
              <span>网站有一定的原创内容</span>
            </li>
          </ul>
          <div class="mt-4 p-3 bg-primary/10 rounded-lg sm:p-4">
            <p class="text-foreground font-medium text-sm sm:text-base">我的网站信息：</p>
            <div class="mt-2 space-y-1 text-xs text-muted-foreground sm:text-sm">
              <p><strong>网站名称：</strong> BX的博客</p>
              <p><strong>网站地址：</strong> https://www.bx33661.com</p>
              <p><strong>网站描述：</strong> 专注于安全研究和技术分享的个人博客</p>
              <p class="break-all"><strong>头像链接：</strong> https://www.bx33661.com/bx.jpg</p>
            </div>
          </div>
        </div>
      </section>
    </ScrollReveal>

    <!-- 友链列表 -->
    <section class="space-y-4 sm:space-y-6">
      <h2 class="font-custom text-foreground text-xl font-bold sm:text-3xl">友链列表</h2>
      <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 sm:gap-6 lg:grid-cols-3">
        {
          FRIEND_LINKS.map((friend, index) => (
            <ScrollReveal client:load direction="up" delay={index * 0.06} threshold={0.2}>
              <div class="group relative overflow-hidden rounded-xl border border-border/60 bg-gradient-to-br from-card/90 via-card/80 to-muted/60 p-4 transition-all duration-300 hover:shadow-lg hover:border-primary/40 hover:-translate-y-1 touch-feedback friend-link-card sm:p-5">
                <div class="flex items-start gap-3 sm:gap-4">
                  <div class="relative overflow-hidden rounded-xl shrink-0 friend-icon-glow bg-muted/70 border border-border/60">
                    {friend.avatar ? (
                      <img 
                        src={friend.avatar} 
                        alt={`${friend.name} logo`}
                        class="h-10 w-10 object-cover transition-transform duration-300 group-hover:scale-110 sm:h-12 sm:w-12"
                        loading="lazy"
                      />
                    ) : (
                      <div class="h-10 w-10 bg-primary/10 rounded-xl flex items-center justify-center sm:h-12 sm:w-12">
                        <Icon name="lucide:globe" class="size-5 text-primary sm:size-6" />
                      </div>
                    )}
                  </div>
                  <div class="flex-1 min-w-0">
                    <h3 class="font-semibold text-foreground text-base group-hover:text-primary transition-colors sm:text-lg">
                      {friend.name}
                    </h3>
                    <p class="text-muted-foreground text-xs mt-1 line-clamp-2 leading-relaxed sm:text-sm">
                      {friend.description}
                    </p>
                  </div>
                </div>
                <Link
                  href={friend.url}
                  class="absolute inset-0 touch-target"
                  aria-label={`访问 ${friend.name}`}
                  target="_blank"
                  rel="noopener noreferrer"
                />
                <div class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity sm:top-4 sm:right-4">
                  <Icon name="lucide:external-link" class="size-3 text-muted-foreground sm:size-4" />
                </div>
              </div>
            </ScrollReveal>
          ))
        }
      </div>
    </section>

    <!-- 组织分块 -->
    <section class="space-y-6">
      <h2 class="font-custom text-foreground text-3xl font-bold">组织</h2>
      <p class="text-muted-foreground">我参与或关注的安全团队与组织：</p>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {
          ORGANIZATION_LINKS.map((org, index) => (
            <ScrollReveal client:load direction="up" delay={index * 0.06} threshold={0.2}>
              <div class="group relative overflow-hidden rounded-xl border border-border/60 bg-gradient-to-br from-card/90 via-card/80 to-muted/60 p-6 transition-all duration-300 hover:shadow-lg hover:border-primary/40 hover:-translate-y-1 friends-org-card touch-feedback">
                <div class="flex items-start gap-4">
                  <div class="relative overflow-hidden rounded-xl shrink-0 bg-muted/70 border border-border/60">
                    {org.avatar ? (
                      <img 
                        src={org.avatar} 
                        alt={`${org.name} logo`}
                        class="h-12 w-12 object-cover transition-transform duration-300 group-hover:scale-110"
                        loading="lazy"
                      />
                    ) : (
                      <div class="h-12 w-12 bg-primary/10 rounded-xl flex items-center justify-center">
                        <Icon name="lucide:shield" class="size-6 text-primary" />
                      </div>
                    )}
                  </div>
                  <div class="flex-1 min-w-0">
                    <h3 class="font-semibold text-foreground text-lg group-hover:text-primary transition-colors">
                      {org.name}
                    </h3>
                    <p class="text-muted-foreground text-sm mt-1 line-clamp-2">
                      {org.description}
                    </p>
                    {org.tags && (
                      <div class="flex flex-wrap gap-1 mt-3">
                        {org.tags.map((tag) => (
                          <span class="bg-primary/10 text-primary text-xs px-2 py-1 rounded-full border border-primary/20">
                            {tag}
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
                <Link
                  href={org.url}
                  class="absolute inset-0"
                  aria-label={`访问 ${org.name}`}
                  target="_blank"
                  rel="noopener noreferrer"
                />
                <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity">
                  <Icon name="lucide:external-link" class="size-4 text-muted-foreground" />
                </div>
              </div>
            </ScrollReveal>
          ))
        }
      </div>
    </section>

    <!-- 联系方式 -->
    <ScrollReveal client:load direction="up" delay={0.05} threshold={0.2}>
      <section class="space-y-6">
        <h2 class="font-custom text-foreground text-3xl font-bold">联系我</h2>
        <div class="text-center space-y-4">
          <p class="text-muted-foreground text-lg">
            如果您想申请友链或有任何问题，欢迎通过以下方式联系我：
          </p>
          <div class="flex flex-wrap justify-center gap-4">
            <Link
              href="mailto:bx33661@gmail.com"
              class={buttonVariants({ variant: 'outline' }) + ' flex items-center gap-2'}
            >
              <Icon name="lucide:mail" class="size-4" />
              邮箱联系
            </Link>
            <Link
              href="https://github.com/bx33661"
              class={buttonVariants({ variant: 'outline' }) + ' flex items-center gap-2'}
            >
              <Icon name="lucide:github" class="size-4" />
              GitHub
            </Link>
          </div>
          <div class="mt-4 text-sm text-muted-foreground">
            <p>微信: bx33661 | QQ: 1811753380</p>
          </div>
        </div>
      </section>
    </ScrollReveal>

    <!-- 返回首页 -->
    <ScrollReveal client:load direction="up" delay={0.08} threshold={0.2}>
      <div class="flex justify-center pt-8">
        <Link
          href="/"
          class={buttonVariants({ variant: 'default' }) + ' group'}
        >
          <Icon name="lucide:home" class="mr-2 size-4" />
          返回首页
          <span class="ml-2 transition-transform group-hover:translate-x-1">&rarr;</span>
        </Link>
      </div>
    </ScrollReveal>
  </div>
</Layout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  @media (prefers-reduced-motion: reduce) {
    .friend-link-card:hover, .group:hover { transform: none !important; }
  }
</style>