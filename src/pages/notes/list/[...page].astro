---
import type { GetStaticPaths } from "astro";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Breadcrumb from "@/components/Breadcrumb.astro";
import Pagination from "@/components/Pagination.astro";
import { SITE } from "@/config.ts";
import { getAllNotesWithSlugs, type NoteWithSlug } from "@/utils/notes";

export const getStaticPaths = (async ({ paginate }) => {
  const notes = await getAllNotesWithSlugs();
  return paginate(notes, { pageSize: 10 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const noteEntries = page.data as NoteWithSlug[];
---

<Layout title={`Notes List | ${SITE.title}`} canonicalURL={Astro.url.toString()}>
  <Header />
  <Breadcrumb />
  <main id="main-content" class="app-layout pb-6">
    <h1 class="text-3xl font-bold tracking-tight">学习笔记列表</h1>
    <ul class="mt-5 space-y-3">
      {noteEntries.map(({ note, slug }) => (
        <li class="rounded-xl border border-border/25 bg-muted/5 p-4">
          <a href={`/notes/${slug}/`} class="font-medium text-foreground hover:text-accent">
            {note.data.title}
          </a>
          <p class="mt-1 text-sm text-foreground/65">{note.data.description}</p>
          <p class="mt-2 text-xs text-foreground/50">{note.data.date.toLocaleDateString("zh-CN")}</p>
        </li>
      ))}
    </ul>
  </main>
  <Pagination page={page as any} />
  <Footer noMarginTop={page.lastPage > 1} />
</Layout>
