---
import Breadcrumbs from '@/components/Breadcrumbs.astro'
import PageHead from '@/components/PageHead.astro'
import Layout from '@/layouts/Layout.astro'
import { getAllProjectSlugs } from '@/lib/data-utils'
import { render } from 'astro:content'
import { Icon } from 'astro-icon/components'

export async function getStaticPaths() {
  const projects = await getAllProjectSlugs()
  return projects.map(({ slug, project }) => ({
    params: { id: slug },
    props: { project, slug },
  }))
}

const { project } = Astro.props
const { Content } = await render(project)
const currentUrl = Astro.url
---

<Layout canonicalUrl={currentUrl}>
  <PageHead
    slot="head"
    title={project.data.name}
    description={project.data.description}
    image={project.data.image.src}
  />

  <Breadcrumbs
    items={[
      { href: '/projects', label: '项目', icon: 'lucide:folder-kanban' },
      { label: project.data.name, icon: 'lucide:file-text' },
    ]}
  />

  <article class="max-screen mt-8 px-4 md:px-6 space-y-6">
    <header class="space-y-4">
      <h1 class="text-4xl font-bold">{project.data.name}</h1>
      <p class="text-muted-foreground text-lg">{project.data.description}</p>
      <img
        src={project.data.image.src}
        alt={project.data.name}
        class="w-full max-h-[420px] object-cover rounded-xl border"
      />
      <div class="flex flex-wrap gap-2">
        {project.data.tags.map((tag) => (
          <span class="text-xs rounded-full px-2 py-1 bg-secondary text-secondary-foreground">
            #{tag}
          </span>
        ))}
      </div>
      <div class="flex flex-wrap items-center gap-4 text-sm text-muted-foreground">
        {project.data.startDate && <span>开始：{project.data.startDate.toLocaleDateString('zh-CN')}</span>}
        {project.data.endDate && <span>结束：{project.data.endDate.toLocaleDateString('zh-CN')}</span>}
        <a
          href={project.data.link}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-1 text-primary hover:underline"
        >
          <Icon name="lucide:external-link" class="size-4" />
          项目链接
        </a>
      </div>
    </header>

    <section class="prose max-w-none sm:max-w-[95ch]">
      <Content />
    </section>

    <div class="pt-8 border-t">
      <a href="/projects" class="inline-flex items-center gap-2 text-primary hover:underline">
        <Icon name="lucide:arrow-left" class="size-4" />
        返回项目列表
      </a>
    </div>
  </article>
</Layout>
