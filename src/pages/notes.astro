---
import TerminalNoteCard from '@/components/terminal/TerminalNoteCard.astro'
import PageHead from '@/components/PageHead.astro'
import Layout from '@/layouts/Layout.astro'
import { getAllNoteSlugs, getAllNoteCategories, getAllNoteTags } from '@/lib/data-utils'

const noteSlugs = await getAllNoteSlugs()
const categories = await getAllNoteCategories()
const tags = await getAllNoteTags()
const currentUrl = Astro.url.toString()

const categoryEntries = Array.from(categories.entries()).sort((a, b) => b[1] - a[1])
---

<Layout canonicalUrl={currentUrl}>
  <PageHead slot="head" title="学习笔记" description="记录技术学习与实践总结。" canonicalURL={currentUrl} />

  <div class="page">
    <h1>学习笔记</h1>
    <p>总笔记：{noteSlugs.length} 篇 {' :: '} 分类：{categories.size} {' :: '} 标签：{tags.size}</p>
    <p><a href="/notes/list/" class="button">按时间分页查看</a></p>
  </div>

  <div class="posts">
    <h2 class="posts-title">分类</h2>
    {categoryEntries.length === 0 ? (
      <p>暂无分类。</p>
    ) : (
      <ul>
        {categoryEntries.map(([category, count]) => (
          <li>{category} ({count})</li>
        ))}
      </ul>
    )}
  </div>

  <div class="posts">
    <h2 class="posts-title">最新笔记</h2>
    {noteSlugs.slice(0, 10).map(({ note, slug }) => (
      <TerminalNoteCard note={note} slug={slug} />
    ))}
  </div>
</Layout>
