---
/**
 * ArticleSchema.astro
 * Provides Article schema for blog posts
 * @see https://schema.org/Article
 * @see https://schema.org/BlogPosting
 */
import { SITE } from '@/consts'

interface Props {
  title: string
  description: string
  datePublished: Date
  dateModified?: Date
  image?: string
  tags?: string[]
  slug: string
}

const { 
  title, 
  description, 
  datePublished, 
  dateModified,
  image, 
  tags = [],
  slug
} = Astro.props

const articleUrl = new URL(`/blog/${slug}`, SITE.href).toString()
const imageUrl = image ? new URL(image, SITE.href).toString() : new URL('/logo.png', SITE.href).toString()

const articleSchema = {
  '@context': 'https://schema.org',
  '@type': 'BlogPosting',
  headline: title,
  description: description,
  image: imageUrl,
  url: articleUrl,
  datePublished: datePublished.toISOString(),
  dateModified: (dateModified || datePublished).toISOString(),
  author: {
    '@type': 'Person',
    name: SITE.author,
    url: SITE.href,
  },
  publisher: {
    '@type': 'Person',
    name: SITE.author,
    logo: {
      '@type': 'ImageObject',
      url: new URL('/logo.png', SITE.href).toString(),
    },
  },
  mainEntityOfPage: {
    '@type': 'WebPage',
    '@id': articleUrl,
  },
  keywords: tags.join(', '),
  inLanguage: SITE.locale,
}

// BreadcrumbList Schema
const breadcrumbSchema = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    {
      '@type': 'ListItem',
      position: 1,
      name: '首页',
      item: SITE.href,
    },
    {
      '@type': 'ListItem',
      position: 2,
      name: '博客',
      item: `${SITE.href}/blog`,
    },
    {
      '@type': 'ListItem',
      position: 3,
      name: title,
      item: articleUrl,
    },
  ],
}
---

<script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
