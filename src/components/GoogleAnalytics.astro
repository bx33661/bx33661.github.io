---
import { GOOGLE_ANALYTICS_ID, ENABLE_ANALYTICS } from '@/config/env'

// 只在生产环境且启用分析时加载
const shouldLoadGA = import.meta.env.PROD && ENABLE_ANALYTICS && GOOGLE_ANALYTICS_ID
---

{shouldLoadGA && (
  <>
    <!-- Google tag (gtag.js) -->
    <script is:inline async src={`https://www.googletagmanager.com/gtag/js?id=${GOOGLE_ANALYTICS_ID}`}></script>
    <script is:inline define:vars={{ GOOGLE_ANALYTICS_ID }}>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      
      gtag('config', GOOGLE_ANALYTICS_ID);
    </script>
  </>
)}

{import.meta.env.DEV && (
  <script is:inline>
    // 开发环境下的模拟 gtag 函数
    window.gtag = function() {
      console.log('[GA Dev Mode]', arguments);
    };
  </script>
)}