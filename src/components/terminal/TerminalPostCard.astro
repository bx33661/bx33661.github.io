---
import { formatDate, readingTime } from '@/lib/utils'
import type { CollectionEntry } from 'astro:content'

interface Props {
  post: CollectionEntry<'blog'>
  slug: string
  showDescription?: boolean
}

const { post, slug, showDescription = true } = Astro.props
const postUrl = `/blog/${slug}/`
const authorLabel = post.data.authors?.length ? post.data.authors.join(', ') : 'BX'
const tags = post.data.tags ?? []
const summary = post.data.description || '暂无摘要。'
const estimatedReadTime = readingTime(post.body || '')
---

<article class="post on-list">
  <h2 class="post-title">
    <a href={postUrl}>{post.data.title}</a>
  </h2>

  <div class="post-meta">
    <time class="post-date" datetime={post.data.date.toISOString()}>
      {formatDate(post.data.date)}
    </time>
    <span class="post-author">{authorLabel}</span>
    <span class="post-author">{estimatedReadTime}</span>
  </div>

  {tags.length > 0 && (
    <span class="post-tags">
      {tags.map((tag) => <a href={`/tags/${encodeURIComponent(tag)}/`}>{tag}</a>)}
    </span>
  )}

  {showDescription && (
    <div class="post-content">
      <p>{summary}</p>
    </div>
  )}

  <div>
    <a href={postUrl} class="read-more button inline">[阅读全文]</a>
  </div>
</article>
