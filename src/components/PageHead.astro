---
import { SITE } from '@/consts'
import { getAllPosts } from '@/lib/data-utils'
interface Props {
  title?: string
  description?: string
  image?: string
  type?: 'website' | 'article'
}

const { 
  title = SITE.title, 
  description = SITE.description,
  image = new URL('/ogImage.png', Astro.site).toString(),
  type = 'website'
} = Astro.props

const posts = await getAllPosts()
const canonicalUrl = Astro.url.toString()
---

<title>{`${SITE.title} - ${title}`}</title>
<meta name="description" content={description} />

<!-- 增强的SEO标签 -->
<meta name="keywords" content="BX, 安全研究, 技术分享, 网络安全, 编程, 博客" />
<meta name="author" content={SITE.author} />
<meta name="creator" content={SITE.author} />
<meta name="publisher" content={SITE.title} />
<meta name="language" content="zh-CN" />
<meta name="revisit-after" content="7 days" />

<!-- Open Graph 增强 -->
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={image} />
<meta property="og:image:alt" content={title} />
<meta property="og:type" content={type} />
<meta property="og:locale" content={SITE.locale} />
<meta property="og:locale:alternate" content="en_US" />
<meta property="og:site_name" content={SITE.title} />
<meta property="og:url" content={canonicalUrl} />

<!-- Twitter Cards 增强 -->
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={image} />
<meta name="twitter:image:alt" content={title} />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content={SITE.author} />
<meta name="twitter:site" content={SITE.href} />
<meta name="twitter:domain" content={SITE.href} />

<!-- 结构化数据增强 -->
<script type="application/ld+json" is:inline set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": `${SITE.href}#website`,
      "url": SITE.href,
      "name": SITE.title,
      "description": SITE.description,
      "publisher": {
        "@id": `${SITE.href}#person`
      },
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": `${SITE.href}/blog?search={search_term_string}`
        },
        "query-input": "required name=search_term_string"
      }
    },
    {
      "@type": "Person",
      "@id": `${SITE.href}#person`,
      "name": SITE.author,
      "url": SITE.href,
      "sameAs": [],
      "jobTitle": "安全研究员",
      "worksFor": {
        "@type": "Organization",
        "name": SITE.title
      }
    },
    {
      "@type": "WebPage",
      "@id": `${canonicalUrl}#webpage`,
      "url": canonicalUrl,
      "name": title,
      "description": description,
      "isPartOf": {
        "@id": `${SITE.href}#website`
      },
      "about": {
        "@id": `${SITE.href}#person`
      },
      "primaryImageOfPage": {
        "@type": "ImageObject",
        "url": image
      },
      "datePublished": new Date().toISOString(),
      "dateModified": new Date().toISOString()
    }
  ]
})} />
